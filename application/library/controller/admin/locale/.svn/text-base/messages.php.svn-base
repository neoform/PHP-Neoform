<?php

	$view = new render_view();
	
	$view->meta_title = 'Locale Translations';
	
	$keys = new locale_key_collection(null, locale_key_dao::all());
		
	$translations = array();
	foreach($keys as $key) {
		$translations[$key->id] = array(
			'key' 		=> htmlspecialchars($key->body),
			'messages' 	=> array(),
		);
		
		foreach (locale_dao::all() as $locale) {
			if ($locale !== $key->locale) {
				try {
					$translations[$key->id]['messages'][$locale] = htmlspecialchars($key->message($locale)->body);
				} catch (exception $e) {
					$translations[$key->id]['messages'][$locale] = '';
				}
			}
		}
	}
		
	$locales = array();
	foreach (locale_dao::all(true) as $locale) {
		$locales[$locale['iso2']] = $locale;
	}	
		
	$view->locales 		= $locales;
	$view->translations = $translations;
		
	$view->render('admin/locale/messages');
	